
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Airline Reviews</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <h1>✈️ Airline Review Sentiment Analysis</h1>
        <form method="POST">
            <label for="airline">Select Airline:</label>
            <select name="airline" id="airline" required>
                {% for airline in airlines %}
                    <option value="{{ airline }}" {% if airline == selected_airline %}selected{% endif %}>{{ airline }}</option>
                {% endfor %}
            </select>

            <label for="month">Select Month:</label>
            <select name="month" id="month" required>
                {% for month in months %}
                    <option value="{{ month }}" {% if month == selected_month %}selected{% endif %}>{{ month }}</option>
                {% endfor %}
            </select>

            <button type="submit">Filter Reviews</button>
        </form>

        <div class="section">
            {% if t_reviews %}
                <h2>Top Reviews for {{ selected_airline }} in {{ selected_month }}</h2>
                <div class="review-list">
                    {% for t_reviews, score in t_reviews %}
                        <div class="review">
                            <div class="review-score positive">Score: {{ score }}</div>
                            <div>{{ t_reviews }}</div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
        </div>

        <div class="section">
            {% if b_reviews %}
                <h2>Lowest Reviews for {{ selected_airline }} in {{ selected_month }}</h2>
                <div class="review-list">
                    {% for b_reviews, score in b_reviews %}
                        <div class="review">
                            <div class="review-score negative">Score: {{ score }}</div>
                            <div>{{ b_reviews }}</div>
                        </div>
                    {% endfor %}
                </div>
            {% endif %}
            {% if not t_reviews and not b_reviews %}
                <p>No reviews found for the selected filters.</p>
            {% endif %}
        </div>

        <div class="window-section">
            {% if positive_window %}
                <div class="window-box">
                    <h3>Most Positive Text Segment (Sliding Window)</h3>
                    <div><strong>Text:</strong> {{ positive_window.paragraph }}</div>
                    <div class="review-score positive">Score: {{ positive_window.score }}</div>
                </div>
            {% endif %}
            {% if negative_window %}
                <div class="window-box">
                    <h3>Most Negative Text Segment (Sliding Window)</h3>
                    <div><strong>Text:</strong> {{ negative_window.paragraph }}</div>
                    <div class="review-score negative">Score: {{ negative_window.score }}</div>
                </div>
            {% endif %}
            <div class="window-section">
            {% if pos_segment %}
                <div class="window-box">
                <h3>Most Positive Segment (Arbitrary Length)</h3>
                <div><strong>Sentences {{ pos_segment.start + 1 }}–{{ pos_segment.end + 1 }}</strong></div>
                <div class="review-score positive">Score: {{ pos_segment.score }}</div>

                <!-- was: <div>{{ pos_segment.text }}</div> -->
                <div class="chunked"
                    data-sentences='{{ pos_segment.sentences | tojson }}'
                    data-chunk="3"></div>
                <noscript>{{ pos_segment.text }}</noscript>
                </div>
            {% endif %}

            {% if neg_segment %}
                <div class="window-box">
                <h3>Most Negative Segment (Arbitrary Length)</h3>
                <div><strong>Sentences {{ neg_segment.start + 1 }}–{{ neg_segment.end + 1 }}</strong></div>
                <div class="review-score negative">Score: {{ neg_segment.score }}</div>

                <!-- was: <div>{{ neg_segment.text }}</div> -->
                <div class="chunked"
                    data-sentences='{{ neg_segment.sentences | tojson }}'
                    data-chunk="3"></div>
                <noscript>{{ neg_segment.text }}</noscript>
                </div>
            {% endif %}
            </div>
        </div>
    </div>
</body>
</html>

<script>
document.addEventListener('DOMContentLoaded', () => {
  function buildChunked(box, sentences, chunkSize){
    let idx = 0;
    const textEl = document.createElement('span');

    const more = document.createElement('a');
    more.href = '#';
    more.className = 'more-link';

    function setLabel(){
      const left = Math.max(0, sentences.length - idx);
      if (left === 0) { more.remove(); return; }
      const step = Math.min(chunkSize, left);
      more.textContent = `… show ${step} more`;
    }

    function addChunk(e){
      if (e) e.preventDefault();
      const end = Math.min(idx + chunkSize, sentences.length);
      const part = sentences.slice(idx, end).join(' ');
      textEl.textContent += (idx ? ' ' : '') + part;
      idx = end;
      setLabel();
    }

    more.addEventListener('click', addChunk);
    more.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); addChunk(); }
    });

    box.appendChild(textEl);
    box.appendChild(document.createTextNode(' '));
    box.appendChild(more);

    setLabel();
    addChunk(); // show first chunk immediately
  }

  document.querySelectorAll('.chunked').forEach(box => {
    const sentences = JSON.parse(box.dataset.sentences || '[]');
    const chunkSize = parseInt(box.dataset.chunk || '3', 10);
    buildChunked(box, sentences, chunkSize);
  });
});
</script>

